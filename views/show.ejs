<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
	<style type="text/css">
	@import "compass/css3";
		div.coverageHistoryButton {
			position: absolute;
			bottom: 25px;
			right: 10px;
		}
		div.editButton {
			position: absolute;
			top: 5px;
			right: 10px;
	}
		
	ul {
		list-style-type: none;
		margin: 0;
		padding: 0;
		overflow: hidden;
	}
	li {
		float: left;
	}
	li a {
		display: block;
		color: white;
		text-align: center;
		padding: 16px;
		text-decoration: none;
	}
	
	input {
	  width: 100%;
	}
	
	select {
	  width: 100%;
	}
	
	td.options {
		max-width: 120px;
	}
	</style>
	
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js"></script>
	
	<script>
	function saveBio(mpid) {
		var text = document.getElementById("editClientBioTextArea").value;

		data = {
			clientBio: text
		};
		
		const updateClientInfo = (mpid) => {
      axios.patch(`/bios/${mpid}`, data)
      .then((res) => { if (res.status === 200){
        document.getElementById("clientBioText").innerHTML = text;
      	document.getElementById("editClientBioTextArea").value="";
      	document.getElementById("editButton1").click();
      }})
      .catch((e) => console.log(e.response.data.error))
    };
	
	  updateClientInfo(mpid, data);
	}
	
	function cancelBio() {
		document.getElementById("editButton1").click();
		document.getElementById("editClientBioTextArea").value="";
	}
	
	function fillContactRow(client){
		var newPosition= document.getElementById("newPosition"+client).value;
		var newName= document.getElementById("newName"+client).value;
		var newID = document.getElementById("newID"+client).value;
		if (client === 'FC') {
  		var newDuration= document.getElementById("newDuration").value;
      var table=document.getElementById("fidessaContacts");
      var table_len=(table.rows.length)-1;
      var row = table.insertRow(table_len).outerHTML="<tr id='row"+client+table_len+"'><td id='positionRow"+client+table_len+"'>"+newPosition+"</td><td id='iDRow"+client+table_len+"' hidden>"+newID+"</td><td id='nameRow"+client+table_len+"'>"+newName+"</td><td id='durationRow"+client+table_len+"'>"+newDuration+"</td><td class='options'><ul><li><button id='save_button"+client+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveContactRow("+JSON.stringify(client+table_len)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(client+table_len)+")'>Deactivate</button></li> <li><button id='edit_button"+client+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editContactRow("+JSON.stringify(client+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+client+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelContactChanges("+JSON.stringify(client+table_len)+")'>Cancel</button></li></ul></td></td></tr>";
      document.getElementById("newDuration").value="";
		} else if (client === 'CC') {
			var newEmail = document.getElementById("newEmail"+client).value;
			var newPhone = document.getElementById("newPhone"+client).value;
			var newLocation = document.getElementById("newLocation"+client).value;
			var newManager = document.getElementById("newManager"+client).value;
		  var newFidessaAdvocate= document.getElementById("newFidessaAdvocate").value;
		  var newComments = document.getElementById("newComments"+client).value;
			var table=document.getElementById("clientContacts");
			var table_len=(table.rows.length)-1;
			var row = table.insertRow(table_len).outerHTML="<tr id='row"+client+table_len+"'><td id='positionRow"+client+table_len+"'>"+newPosition+"</td><td id='iDRow"+client+table_len+"' hidden>"+newID+"</td><td id='nameRow"+client+table_len+"'>"+newName+"</td><td id='emailRow"+client+table_len+"'>"+newEmail+"</td><td id='phoneRow"+client+table_len+"'>"+newPhone+"</td><td id='locationRow"+client+table_len+"'>"+newLocation+"</td><td id='managerRow"+client+table_len+"'>"+newManager+"</td><td id='advocateRow"+client+table_len+"'>"+newFidessaAdvocate+"</td><td id='commentsRow"+client+table_len+"'>"+newComments+"</td><td class='options'><ul><li><button id='save_button"+client+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveContactRow("+JSON.stringify(client+table_len)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(client+table_len)+")'>Delete</button></li> <li><button id='edit_button"+client+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editContactRow("+JSON.stringify(client+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+client+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelContactChanges("+JSON.stringify(client+table_len)+")'>Cancel</button></li></ul></td></tr>";
		  document.getElementById("newFidessaAdvocate").value="";
		  document.getElementById("newEmail"+client).value="";
		  document.getElementById("newPhone"+client).value="";
		  document.getElementById("newLocation"+client).value="";
		  document.getElementById("newManager"+client).value="";
		  document.getElementById("newComments"+client).value="";
		}
		document.getElementById("save_button"+client+table_len).disabled = true;
		document.getElementById("cancel_button"+client+table_len).hidden = true;
		
		document.getElementById("newID"+client).value="";
	  document.getElementById("newPosition"+client).value="";
		document.getElementById("newName"+client).value="";
		document.activeElement.blur()
	}
	
	function fillFlowsRow(table, mpid){
	  var newFlowType= document.getElementById("newFlowType"+table).value;
	  var newID = document.getElementById("newID"+table).value;
		var newSystem= document.getElementById("newFlowSystem"+table).value;
		var newComment = document.getElementById("newFlowComments"+table).value;
		if (table === 'FF') {
      var tableType=document.getElementById("fidessaUsedSystems");
      var table_len=(tableType.rows.length)-1;
      var row = tableType.insertRow(table_len).outerHTML="<tr id='row"+table+table_len+"'><td id='flowTypeRow"+table+table_len+"'>"+newFlowType+"</td><td id='iDRow"+table+table_len+"' hidden>"+newID+"</td><td id='sysetmRow"+table+table_len+"'>"+newSystem+"</td><td id='commentsRow"+table+table_len+"'>"+newComment+"</td><td class='options'><ul><li><button id='save_button"+table+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveFlowsRow("+JSON.stringify(table+table_len+mpid)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(table+table_len+mpid)+")'>Delete</button></li> <li><button id='edit_button"+table+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editFlowsRow("+JSON.stringify(table+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+table+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelFlowsChanges("+JSON.stringify(table+table_len)+")'>Cancel</button></li></ul></td></tr>";
		} else if (table === 'AD') {
		  var tableType=document.getElementById("adjacentFlows");
      var table_len=(tableType.rows.length)-1;
      var row = tableType.insertRow(table_len).outerHTML="<tr id='row"+table+table_len+"'><td id='flowTypeRow"+table+table_len+"'>"+newFlowType+"</td><td id='iDRow"+table+table_len+"' hidden>"+newID+"</td><td id='sysetmRow"+table+table_len+"'>"+newSystem+"</td><td id='commentsRow"+table+table_len+"'>"+newComment+"</td><td class='options'><ul><li><button id='save_button"+table+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveFlowsRow("+JSON.stringify(table+table_len+mpid)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(table+table_len+mpid)+")'>Delete</button></li> <li><button id='edit_button"+table+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editFlowsRow("+JSON.stringify(table+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+table+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelFlowsChanges("+JSON.stringify(table+table_len)+")'>Cancel</button></li></ul></td></tr>";
		} else if (table === 'NA') {
		  var tableType=document.getElementById("nonAdjacentFlows");
      var table_len=(tableType.rows.length)-1;
      var row = tableType.insertRow(table_len).outerHTML="<tr id='row"+table+table_len+"'><td id='flowTypeRow"+table+table_len+"'>"+newFlowType+"</td><td id='iDRow"+table+table_len+"' hidden>"+newID+"</td><td id='sysetmRow"+table+table_len+"'>"+newSystem+"</td><td id='commentsRow"+table+table_len+"'>"+newComment+"</td><td class='options'><ul><li><button id='save_button"+table+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveFlowsRow("+JSON.stringify(table+table_len+mpid)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(table+table_len+mpid)+")'>Delete</button></li> <li><button id='edit_button"+table+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editFlowsRow("+JSON.stringify(table+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+table+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelFlowsChanges("+JSON.stringify(table+table_len)+")'>Cancel</button></li></ul></td></tr>";
		}
		document.getElementById("save_button"+table+table_len).disabled = true;
		document.getElementById("cancel_button"+table+table_len).hidden = true;
		document.getElementById("newFlowType"+table).value="";
		document.getElementById("newID"+table).value="";
		document.getElementById("newFlowSystem"+table).value="";
		document.getElementById("newFlowComments"+table).value="";
	}
	
	function addContactRow(client, mpid){
	  if (document.getElementById("newPosition"+client).value !== "" && document.getElementById("newName"+client).value !== ""){
		var newPosition= document.getElementById("newPosition"+client).value;
		var newName= document.getElementById("newName"+client).value;
		if (client === 'FC') {
			if (document.getElementById("newDuration").value !== ""){
			var newDuration= document.getElementById("newDuration").value;
			var coverage = newDuration.split('-');
			var coverageStart = coverage[0];
			var coverageEnd = coverage[1];
			
			const data = {
			  position: newPosition,
			  name: newName,
			  coverageStart: coverageStart,
			  coverageEnd: coverageEnd,
			  mpid: mpid,
			  active: true,
			}
			
			const addCoverageContacts = (data) => {
			  axios.post(`/coverage`, data)
			  .then((res) => { if (res.status === 200){
			    var id = res.data.newContact._id
			    var table=document.getElementById("fidessaContacts");
    			var table_len=(table.rows.length)-1;
    			var row = table.insertRow(table_len).outerHTML="<tr id='row"+client+table_len+"'><td id='positionRow"+client+table_len+"'>"+newPosition+"</td><td id='iDRow"+client+table_len+"' hidden>"+id+"</td><td id='nameRow"+client+table_len+"'>"+newName+"</td><td id='durationRow"+client+table_len+"'>"+newDuration+"</td><td class='options'><ul><li><button id='save_button"+client+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveContactRow("+JSON.stringify(client+table_len)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(client+table_len)+")'>Deactivate</button></li> <li><button id='edit_button"+client+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editContactRow("+JSON.stringify(client+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+client+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelContactChanges("+JSON.stringify(client+table_len)+")'>Cancel</button></li></ul></td></tr>";
    			document.getElementById("newDuration").value="";
	      		document.getElementById("newPosition"+client).value="";
	      		document.getElementById("newName"+client).value="";
	      		document.getElementById("save_button"+client+table_len).disabled = true;
	      		document.getElementById("cancel_button"+client+table_len).hidden = true;
			  }})
			  .catch((e) => console.log(e))
			};
			addCoverageContacts(data);
			}
		} else if (client === 'CC') {
		  var newEmail = document.getElementById("newEmail"+client).value;
			var newPhone = document.getElementById("newPhone"+client).value;
			var newLocation = document.getElementById("newLocation"+client).value;
			var newManager = document.getElementById("newManager"+client).value;
		  var newFidessaAdvocate= document.getElementById("newFidessaAdvocate").value;
		  var newComments = document.getElementById("newComments"+client).value;
		  manager = newManager.split(',')
		  const data = {
		    position: newPosition,
		    name: newName,
		    email: newEmail,
		    phone: newPhone,
		    location: newLocation,
		    managerName: manager[0],
		    managerTitle: manager[1],
		    advocate: newFidessaAdvocate,
		    comments: newComments,
		    mpid: mpid,
		  }
		  
		  const addClientDetails = (data) => {
		    axios.post(`/clients`, data)
		    .then((res) => { if (res.status === 200) {
		      var id = res.data.newContact._id
		      var table=document.getElementById("clientContacts");
    			var table_len=(table.rows.length)-1;
					var row = table.insertRow(table_len).outerHTML="<tr id='row"+client+table_len+"'><td id='positionRow"+client+table_len+"'>"+newPosition+"</td><td id='iDRow"+client+table_len+"' hidden>"+id+"</td><td id='nameRow"+client+table_len+"'>"+newName+"</td><td id='emailRow"+client+table_len+"'>"+newEmail+"</td><td id='phoneRow"+client+table_len+"'>"+newPhone+"</td><td id='locationRow"+client+table_len+"'>"+newLocation+"</td><td id='managerRow"+client+table_len+"'>"+newManager+"</td><td id='advocateRow"+client+table_len+"'>"+newFidessaAdvocate+"</td><td id='commentsRow"+client+table_len+"'>"+newComments+"</td><td class='options'><ul><li><button id='save_button"+client+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveContactRow("+JSON.stringify(client+table_len)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(client+table_len)+")'>Delete</button></li> <li><button id='edit_button"+client+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editContactRow("+JSON.stringify(client+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+client+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelContactChanges("+JSON.stringify(client+table_len)+")'>Cancel</button></li></ul></td></tr>";
    		  document.getElementById("newFidessaAdvocate").value="";
    		  document.getElementById("newPosition"+client).value="";
      		document.getElementById("newName"+client).value="";
      		document.getElementById("newEmail"+client).value="";
				  document.getElementById("newPhone"+client).value="";
				  document.getElementById("newLocation"+client).value="";
				  document.getElementById("newManager"+client).value="";
				  document.getElementById("newComments"+client).value="";
      		document.getElementById("save_button"+client+table_len).disabled = true;
      		document.getElementById("cancel_button"+client+table_len).hidden = true;
		    }}) 
			.catch((e) => console.log(e))
		};
		addClientDetails(data);
	  }
		document.activeElement.blur()
	  }
	}
	
	function addFlowsRow(table, mpid) {
	  if (document.getElementById("flowType"+table).value !== "" && document.getElementById("flowSystem"+table).value !== "") {
	    var newFlowType= document.getElementById("flowType"+table).value;
		  var newSystem= document.getElementById("flowSystem"+table).value;
		  var newComment = document.getElementById("flowComments"+table).value;
		  if (table === 'FF') {
		     const data = {
		      flowType: newFlowType,
          supported: true,
          adjacent: false,
          system: newSystem,
          comments: newComment,
		      }
		    const addFlows = (mpid, data) => {
  		    axios.patch(`/bios/${mpid}/add-flows`, data)
  		    .then((res) => {if (res.status===200){
  		      console.log(res.data)
  		       var id = res.data.updatedFlows.flows[res.data.updatedFlows.flows.length-1]._id
    		     var tableType=document.getElementById("fidessaUsedSystems");
        		 var table_len=(tableType.rows.length)-1;
             var row = tableType.insertRow(table_len).outerHTML="<tr id='row"+table+table_len+"'><td id='flowTypeRow"+table+table_len+"'>"+newFlowType+"</td><td id='iDRow"+table+table_len+"' hidden>"+id+"</td><td id='sysetmRow"+table+table_len+"'>"+newSystem+"</td><td id='commentsRow"+table+table_len+"'>"+newComment+"</td><td class='options'><ul><li><button id='save_button"+table+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveFlowsRow("+JSON.stringify(table+table_len+mpid)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(table+table_len+mpid)+")'>Delete</button></li> <li><button id='edit_button"+table+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editFlowsRow("+JSON.stringify(table+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+table+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelFlowsChanges("+JSON.stringify(table+table_len)+")'>Cancel</button></li></ul></td></tr>";
  		       document.getElementById("flowType"+table).value="";
        	 	 document.getElementById("flowSystem"+table).value="";
        		 document.getElementById("flowComments"+table).value="";
        		 document.getElementById("save_button"+table+table_len).disabled = true;
      			 document.getElementById("cancel_button"+table+table_len).hidden = true;
  		    }})
  		    .catch((e) => console.log(e.response.data.error))
		    }
		  addFlows(mpid,data);
		  } else if (table === 'AD') {
		     const data = {
		      flowType: newFlowType,
          supported: false,
          adjacent: true,
          system: newSystem,
          comments: newComment,
		      }
		    const addFlows = (mpid, data) => {
  		    axios.patch(`/bios/${mpid}/add-flows`, data)
  		    .then((res) => {if (res.status===200){
  		       var id = res.data.updatedFlows.flows[res.data.updatedFlows.flows.length-1]._id
    		     var tableType=document.getElementById("adjacentFlows");
        		 var table_len=(tableType.rows.length)-1;
             var row = tableType.insertRow(table_len).outerHTML="<tr id='row"+table+table_len+"'><td id='flowTypeRow"+table+table_len+"'>"+newFlowType+"</td><td id='iDRow"+table+table_len+"' hidden>"+id+"</td><td id='sysetmRow"+table+table_len+"'>"+newSystem+"</td><td id='commentsRow"+table+table_len+"'>"+newComment+"</td><td class='options'><ul><li><button id='save_button"+table+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveFlowsRow("+JSON.stringify(table+table_len+mpid)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(table+table_len+mpid)+")'>Delete</button></li> <li><button id='edit_button"+table+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editFlowsRow("+JSON.stringify(table+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+table+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelFlowsChanges("+JSON.stringify(table+table_len)+")'>Cancel</button></li></ul></td></tr>";
  		       document.getElementById("flowType"+table).value="";
        	 	 document.getElementById("flowSystem"+table).value="";
        		 document.getElementById("flowComments"+table).value="";
        		 document.getElementById("save_button"+table+table_len).disabled = true;
      			 document.getElementById("cancel_button"+table+table_len).hidden = true;
  		    }})
  		    .catch((e) => console.log(e.response.data.error))
		    }
		  addFlows(mpid,data);
		  } else if (table === 'NA') {
		     const data = {
		      flowType: newFlowType,
          supported: false,
          adjacent: false,
          system: newSystem,
          comments: newComment,
		      }
		    const addFlows = (mpid, data) => {
  		    axios.patch(`/bios/${mpid}/add-flows`, data)
  		    .then((res) => {if (res.status===200){
  		       var id = res.data.updatedFlows.flows[res.data.updatedFlows.flows.length-1]._id
    		     var tableType=document.getElementById("nonAdjacentFlows");
        		 var table_len=(tableType.rows.length)-1;
             var row = tableType.insertRow(table_len).outerHTML="<tr id='row"+table+table_len+"'><td id='flowTypeRow"+table+table_len+"'>"+newFlowType+"</td><td id='iDRow"+table+table_len+"' hidden>"+id+"</td><td id='sysetmRow"+table+table_len+"'>"+newSystem+"</td><td id='commentsRow"+table+table_len+"'>"+newComment+"</td><td class='options'><ul><li><button id='save_button"+table+table_len+"' class='save align-middle btn btn-sm btn-outline-success my-2 my-sm-0' onclick='saveFlowsRow("+JSON.stringify(table+table_len+mpid)+")'>Save</button></li> <li><button class='delete align-middle btn btn-sm btn-outline-danger my-2 my-sm-0' onclick='deleteRow("+JSON.stringify(table+table_len+mpid)+")'>Delete</button></li> <li><button id='edit_button"+table+table_len+"' class ='edit align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='editFlowsRow("+JSON.stringify(table+table_len)+")'>Edit</button></li> <li><button id='cancel_button"+table+table_len+"' class='cancel align-middle btn btn-sm btn-outline-secondary my-2 my-sm-0' onclick='cancelFlowsChanges("+JSON.stringify(table+table_len)+")'>Cancel</button></li></ul></td></tr>";
  		       document.getElementById("flowType"+table).value="";
        	 	 document.getElementById("flowSystem"+table).value="";
        		 document.getElementById("flowComments"+table).value="";
        		 document.getElementById("save_button"+table+table_len).disabled = true;
      			 document.getElementById("cancel_button"+table+table_len).hidden = true;
  		    }})
  		    .catch((e) => console.log(e.response.data.error))
		    }
		  addFlows(mpid,data);
	  }
	}
	document.activeElement.blur()
	}
	
	function editContactRow(clientNo) {
	  var client = clientNo.slice(0,2)
	  var no = clientNo.slice(2)
	  
	  var row=document.getElementById("row"+client+no);
	  var cell = row.getElementsByTagName("td");
	  
	  if (client === "FC") {
	  	var oldValue1 = cell[0].innerText;
		  var oldValue2 = cell[1].innerText;
		  var oldValue3 = cell[2].innerText;
		  var oldValue4 = cell[3].innerText;
	    document.getElementById("durationRow"+client+no).contentEditable = true;
	    var oldValues = oldValue1 + '|' + oldValue2 + '|' + oldValue3 + '|' + oldValue4
	  } else if (client === "CC") {
	  	var oldValue1 = cell[0].innerText;
		  var oldValue2 = cell[1].innerText;
		  var oldValue3 = cell[2].innerText;
		  var oldValue4 = cell[3].innerText;
		  var oldValue5 = cell[4].innerText;
		  var oldValue6 = cell[5].innerText;
		  var oldValue7 = cell[6].innerText;
		  var oldValue8 = cell[7].innerText;
		  var oldValue9 = cell[8].innerText;
	    document.getElementById("advocateRow"+client+no).contentEditable = true;
	    document.getElementById("positionRow"+client+no).contentEditable = true;
	    document.getElementById("emailRow"+client+no).contentEditable = true;
	    document.getElementById("phoneRow"+client+no).contentEditable = true;
	    document.getElementById("locationRow"+client+no).contentEditable = true;
	    document.getElementById("managerRow"+client+no).contentEditable = true;
	    document.getElementById("commentsRow"+client+no).contentEditable = true;
	    var oldValues = oldValue1 + '|' + oldValue2 + '|' + oldValue3 + '|' + oldValue4 + '|' + oldValue5 + '|' + oldValue6 + '|' + oldValue7 + '|' + oldValue8 + '|' + oldValue9
	  }
	  document.getElementById("save_button"+client+no).disabled = false;
	  document.getElementById("cancel_button"+client+no).hidden = false;
	  document.getElementById("edit_button"+client+no).disabled = true;
	  document.activeElement.blur()
	  
	 document.getElementById("hiddenEntry").innerHTML = oldValues
	}
	
	function editFlowsRow(tableNo){
		var table = tableNo.slice(0,2)
	  var no = tableNo.slice(2)
	  var row=document.getElementById("row"+table+no);
	  var cell = row.getElementsByTagName("td");
	  
	  var oldValue1 = cell[0].innerText;
	  var oldValue2 = cell[1].innerText;
	  var oldValue3 = cell[2].innerText;
	  var oldValue4 = cell[3].innerText;
	  var oldValues = oldValue1 + '|' + oldValue2 + '|' + oldValue3 + '|' + oldValue4
	  
	  document.getElementById("commentsRow"+table+no).contentEditable = true;
	  
	  document.getElementById("save_button"+table+no).disabled = false;
	  document.getElementById("cancel_button"+table+no).hidden = false;
	  document.getElementById("edit_button"+table+no).disabled = true;
	  document.activeElement.blur()
	  
	  document.getElementById("hiddenEntry").innerHTML = oldValues
	}
	
	function saveContactRow(clientNo) {
	  var client = clientNo.slice(0,2)
	  var no = clientNo.slice(2)

	  var row=document.getElementById("row"+client+no);
	  var cell = row.getElementsByTagName("td");
	  var title = cell[0].innerText;
	  var id = cell[1].innerText
	  var name = cell[2].innerText;
	  
		if (client === "FC") {
			var duration = cell[3].innerText.split('-');
			// var coverageStart = moment(duration[0]);
			// var coverageEnd = moment(duration[1],  moment.ISO_8601);
			var data= {
					coverageStart: duration[0],
					coverageEnd: duration[1],
			}
		  const updateCoverageContact = (id, data) => {
		    axios.patch(`/coverage/${id}`, data)
		    .then((res) => {if (res.status===200){
		      document.getElementById("positionRow"+client+no).innerHTML=title;
		      document.getElementById("nameRow"+client+no).innerHTML=name;
		      document.getElementById("durationRow"+client+no).innerHTML=cell[3].innerText;
		      console.log(res)
		    }})
		    .catch((e) => console.log(e.response.data.error))
		  }
		  updateCoverageContact(id, data)
		} else if (client === "CC") {
			var email = cell[3].innerText;
			var phone = cell[4].innerText;
			var location = cell[5].innerText;
			var newManager = cell[6].innerText;
			var advocate = cell[7].innerText;
			var comments = cell[8].innerText;
			
			manager = newManager.split(',')
			var data = {
				position: title,
				name: name,
				email: email,
				phone: phone,
				location: location,
				managerName: manager[0],
				managerTitle: manager[1],
				advocate: advocate,
				comments: comments,
			}
			const updateClientContact = (id, data) => {
				axios.patch(`/clients/${id}`, data)
				.then((res) => {if(res.status===200){
					document.getElementById("positionRow"+client+no).innerHTML=title;
					document.getElementById("nameRow"+client+no).innerHTML=name;
			  	document.getElementById("emailRow"+client+no).innerHTML=email;
			  	document.getElementById("phoneRow"+client+no).innerHTML=phone;
			  	document.getElementById("locationRow"+client+no).innerHTML=location;
			  	document.getElementById("managerRow"+client+no).innerHTML=manager;
			  	document.getElementById("advocateRow"+client+no).innerHTML=advocate;
			  	document.getElementById("commentsRow"+client+no).innerHTML=comments;
				}})
				.catch((e)=>console.log(e.response.data.error))
			}
			updateClientContact(id, data);
		}
		document.getElementById("cancel_button"+client+no).hidden = true;
	  document.getElementById("edit_button"+client+no).disabled = false;
	  
	  document.getElementById("positionRow"+client+no).contentEditable = false;
	  document.getElementById("nameRow"+client+no).contentEditable = false;
	  if (client === "FC") {
	    document.getElementById("durationRow"+client+no).contentEditable = false;
	  } else if (client === "CC") {
	  	document.getElementById("advocateRow"+client+no).contentEditable = false;
	    document.getElementById("positionRow"+client+no).contentEditable = false;
	    document.getElementById("emailRow"+client+no).contentEditable = false;
	    document.getElementById("phoneRow"+client+no).contentEditable = false;
	    document.getElementById("locationRow"+client+no).contentEditable = false;
	    document.getElementById("managerRow"+client+no).contentEditable = false;
	    document.getElementById("commentsRow"+client+no).contentEditable = false;
	  }
	  document.getElementById("save_button"+client+no).disabled = true;
	}
	
	function saveFlowsRow(tableNo) {
		var client = tableNo.slice(0,2)
	  var no = tableNo.slice(2,3)
	  var mpid = tableNo.slice(3)

	  var row=document.getElementById("row"+client+no);
	  var cell = row.getElementsByTagName("td");
	  var flowType = cell[0].innerText;
	  var id = cell[1].innerText
	  var system = cell[2].innerText;
	  var comment = cell[3].innerText;
	  
	  var data= {
	  	id: id,
	  	comment: comment
	  }
	  
	  var updateFlows = (mpid, data) => {
	  	axios.patch(`/bios/${mpid}/update-flow`, data)
	  	.then((res)=>console.log(res))
	  	.catch((e)=>console.log(e.response))
	  }
	  updateFlows(mpid, data)
	  document.getElementById("commentsRow"+client+no).contentEditable = false;
	  
	  document.getElementById("cancel_button"+client+no).hidden = true;
	  document.getElementById("edit_button"+client+no).disabled = false;
	  document.getElementById("save_button"+client+no).disabled = true;
	}
	
	function deleteRow(clientNo) {
	  var type = clientNo.slice(0,2);
	  var no = clientNo.slice(2,3);
	  
	  if (type === 'FF' || type === 'AD' || type === 'NA') {
	  	var mpid = clientNo.slice(3)
	  }
	  
	  var row=document.getElementById("row"+type+no);
	  var cell = row.getElementsByTagName("td");
	  var id = cell[1].innerText;
	 
	 if (type === 'FC') {
	 	var data = {
	 		active: false
	 	}
	 	const updateCoverageContact = (id, data) => {
		    axios.patch(`/coverage/${id}`, data)
		    .then((res) => {if (res.status===200){
		      document.getElementById("row"+type+no).outerHTML="";
		    }})
		    .catch((e) => console.log(e))
		  }
		  updateCoverageContact(id, data)
	 } else if (type === 'CC') {
	   const deleteClientContact = (id) => {
  	   axios.delete(`/clients/${id}`)
  	   .then((res) => {if (res.status===200){document.getElementById("row"+type+no+"").outerHTML=""}})
  	   .catch((e) => console.log(e.response.data.error))
	   }
	   deleteClientContact(id)
	 } else if (type === 'FF' || type === 'AD' || type === 'NA') {
	 	var data = {
	 		id: id
	 	}
	 	const deleteFidessaFlow = (mpid) => {
	 		axios.patch(`/bios/${mpid}/delete-flow`, data)
  	  .then((res) => {if (res.status===200){document.getElementById("row"+type+no+"").outerHTML=""}})
  	  .catch((e) => console.log(e.response.data.error))
	 }
	 deleteFidessaFlow(mpid, data)
	}
	}
	
	function cancelContactChanges(clientNo){
	  var client = clientNo.slice(0,2)
	  var no = clientNo.slice(2)
	  var oldValues = document.getElementById("hiddenEntry").innerHTML
	  var old = oldValues.split('|')
	  
	  document.getElementById("positionRow"+client+no).innerHTML=old[0];
		document.getElementById("nameRow"+client+no).innerHTML=old[2];
		if (old.length !== 4) {
		  old[3] = "";
		}
		if (client === "FC") {
		    document.getElementById("durationRow"+client+no).innerHTML=old[3];
		} else if (client === "CC") {
		  document.getElementById("advocateRow"+client+no).innerHTML=old[3];
		}
		
		document.getElementById("cancel_button"+client+no).hidden = true;
	  document.getElementById("edit_button"+client+no).disabled = false;
	  document.getElementById("save_button"+client+no).disabled = true;
	  
	  document.getElementById("positionRow"+client+no).contentEditable = false;
	  document.getElementById("nameRow"+client+no).contentEditable = false;
	  if (client === "FC") {
	    document.getElementById("durationRow"+client+no).contentEditable = false;
	  } else if (client === "CC") {
	    document.getElementById("advocateRow"+client+no).contentEditable = false;
	    document.getElementById("positionRow"+client+no).contentEditable = false;
	    document.getElementById("emailRow"+client+no).contentEditable = false;
	    document.getElementById("phoneRow"+client+no).contentEditable = false;
	    document.getElementById("locationRow"+client+no).contentEditable = false;
	    document.getElementById("managerRow"+client+no).contentEditable = false;
	    document.getElementById("commentsRow"+client+no).contentEditable = false;
	  }
	}
	
	function cancelFlowsChanges(tableNo) {
		var client = tableNo.slice(0,2)
	  var no = tableNo.slice(2)
	  var oldValues = document.getElementById("hiddenEntry").innerHTML
	  var old = oldValues.split('|')
	  
	  document.getElementById("flowTypeRow"+client+no).innerHTML=old[0];
	  document.getElementById("sysetmRow"+client+no).innerHTML=old[2];
	  document.getElementById("commentsRow"+client+no).innerHTML=old[3];
	  
	  document.getElementById("cancel_button"+client+no).hidden = true;
	  document.getElementById("edit_button"+client+no).disabled = false;
	  document.getElementById("save_button"+client+no).disabled = true;
	  
	  document.getElementById("commentsRow"+client+no).contentEditable = false;
	}
	
	function getSystems(table, flows) 
     {
      var fidessaFlowType = document.getElementById("flowType"+table).value;
      var systems = flows.filter(data => data.flowType === fidessaFlowType)
      if (table === 'FF') {
        showFidessaFlowSystems(systems[0].systems)
      } else if (table === 'AD') {
        showFidessaAdjacentSystems(systems[0].systems)
      } else if (table === 'NA') {
        showFidessaNonAdjacentSystems(systems[0].systems)
      }
     }
	</script>
	
    <title>CRM Tool <% source[0].clientName %></title>
  </head>
  <body>
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
              <a class="navbar-brand" href="#">Delivery Management</a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
              </button>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                          <li class="nav-item active">
                                    <a class="nav-link" href="/pages">CRM Home <span class="sr-only">(current)</span></a>
                          </li>
                          <!--<li class="nav-item">-->
                          <!--          <a class="nav-link" href="#">Edit</a>-->
                          <!--</li>-->
                        </ul>
                        <!--<form class="form-inline my-2 my-lg-0">-->
                        <!--  <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">-->
                        <!--  <button class="btn btn-outline-primary my-2 my-sm-0" type="submit">Search</button>-->
                        <!--</form>-->
              </div>
            </nav>
  
    <!-- MPID and Address -->
    <div class="container-fluid border border-dark p-3 text-center">
      <div class="row">
        <div class="col-lg-4 col-md-4 col-sm-12">
          <h1><%= source[0].clientMnemonic %></h1>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-12">
          <h1><%= source[0].clientName %></h1>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-12">
          <a href="" target="_blank"><p><%= bio[0].address %></p>
          </a>
        </div>
      </div>
    </div>

            <!-- Client Bio -->
            <div class="container-fluid border border-dark p-5 text-center">
                        <div class="row">
                                    <div class="col-lg-12 col-md-12 col-sm-12">
                                                <h1>Client Bio</h1>
												<div id="clientBio">
													<p id="clientBioText"><%= bio[0].clientBio %></p>
													<div class="editButton">
														<button id="editButton1" class="btn btn-sm btn-outline-secondary my-2 my-sm-0" type="button" data-toggle="collapse" data-target="#editClientBio" aria-expanded="false" aria-controls="editClientBio">
														Edit
														</button>
													</div>
													<div class="row">
														<div class="col">
															<div class="collapse multi-collapse" id="editClientBio">
																<div class="card card-body">
																	<textarea class="form-control" id="editClientBioTextArea" rows="3"></textarea>
																	<ul>
																	<li>
																	<div class="row">
																		<div class="col">
																			<button type="submit" class="btn btn-sm btn-outline-success my-2 my-sm-0" onclick='saveBio("<%= source[0].clientMnemonic %>")'>Save</button>
																		</div>
																	</div>
																	</li>
																	<li>
																	<div class="row">
																		<div class="col">
																			<button type="cancel" class="btn btn-sm btn-outline-secondary my-2 my-sm-0" onclick='cancelBio()'>Cancel</button>
																		</div>
																	</div>
																	</li>
																	</ul>
																</div>
															</div>
														</div>
													</div>
												</div>
                                    </div>
                        </div>
            </div>
            
    <!-- SharePoint Information -->
    <div class="container-fluid border border-dark p-5">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
          <h1 class="text-center">Client Information</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-3 col-md-6 col-sm-12">
          <div class="card border-dark mb-3" >
            <div class="card-header text-center">Service</div>
            <div class="card-body">
              <h5 class="card-title text-center"><%= source[0].service %></h5>
          </div>
         </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12">
          <div class="card border-dark mb-3" >
            <div class="card-header text-center">Service Line</div>
            <div class="card-body">
              <h5 class="card-title text-center"><%= source[0].serviceLine %></h5>
          </div>
         </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12">
          <div class="card border-dark mb-3" >
            <div class="card-header text-center">Sub Region</div>
            <div class="card-body">
              <h5 class="card-title text-center"><%= source[0].subRegion %></h5>
          </div>
         </div>
        </div>
                        <div class="col-lg-3 col-md-6 col-sm-12">
          <div class="card border-dark mb-3" >
            <div class="card-header text-center">Class</div>
            <div class="card-body">
              <h5 class="card-title text-center"><%= source[0].clientClass %></h5>
          </div>
         </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-3 col-md-6 col-sm-12">
          <div class="card border-dark mb-3" >
            <div class="card-header text-center">Service Platform</div>
            <div class="card-body">
              <h5 class="card-title text-center"><%= source[0].servicePlatform %></h5>
          </div>
         </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12">
          <div class="card border-dark mb-3" >
            <div class="card-header text-center">Active/Inactive Date</div>
            <div class="card-body">
              <h5 class="card-title text-center"><%= source[0].goLiveDate %></h5>
          </div>
         </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12">
          <div class="card border-dark mb-3" >
            <div class="card-header text-center">Status</div>
            <div class="card-body">
              <h5 class="card-title text-center"><%= bio[0].status %></h5>
          </div>
         </div>
        </div>
      </div>
    </div>


    <!-- Systems Information -->
    <div class="container-fluid border border-dark text-center">
                        <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 border border-dark p-5">
                                    <h1>Fidessa Contacts</h1>
            <table class="table table-sm table-bordered" id = "fidessaContacts">
              <thead class="thead-dark">
                <tr>
                  <th class="align-middle" scope="col">Title</th>
                  <th class="align-middle" scope="col" hidden>ID</th>
                  <th class="align-middle" scope="col">Name</th>
                  <th class="align-middle" scope="col">Duration</th>
                </tr>
              </thead>
              <tbody>
                <% var activeCoverage = coverage.filter(item => item.active === true);
                	if (activeCoverage.length === 0) { %>
        					<th scope="row"><input type='text' id='newPositionFC' value=''></th>
        					<td hidden><input type='text' id='newIDFC' value=''></td>
                  <td><input type='text' id='newNameFC' value=''></td>
                  <td><input type='text' id='newDuration' value=''></td>
		              <td class='options'><ul><li><button id="addRowFC" class="add align-middle btn btn-sm btn-outline-success my-2 my-sm-0" type="submit" onclick="addContactRow('FC', '<%= source[0].clientMnemonic %>');">Add Row</button></li></ul></td>
		            <% } %>
                <% activeCoverage.forEach(function(data,index){ %>
                <tr id = rowFC>
                  <th scope="row"><input type='text' id='newPositionFC' value='<%= data.position %>'></th>
                  <td hidden><input type='text' id='newIDFC' value='<%= data._id %>'></td>
                  <td><input type='text' id='newNameFC' value='<%= data.name %>'></td>
                  <td><input type='text' id='newDuration' value='<%= moment(data.coverageStart).format(shortDateFormat) %> - <%= moment(data.coverageEnd).format(shortDateFormat) %>'></td>
        				  <script>
          					fillContactRow('FC')
          					<% if (index !== activeCoverage.length-1) { %>
          					document.getElementById("rowFC").outerHTML="";
          					<% } %>
        				  </script>
        				  <td class='options'><ul><li><button id="addRowFC" class="add align-middle btn btn-sm btn-outline-success my-2 my-sm-0" type="submit" onclick="addContactRow('FC', '<%= source[0].clientMnemonic %>')">Add Row</button></li></ul></td>
                </tr>
                <% }); %>
              </tbody>
            </table>
         <div class="coverageHistoryButton">
					<button id="coverageButton" class="btn btn-sm btn-outline-secondary my-2 my-sm-0" type="button" data-toggle="modal" data-target="#coverageHistory">
						Coverage History
					</button>
					<div class="modal fade" id="coverageHistory" tabindex="-1" role="dialog" aria-labelledby="coverageHistoryTitle" aria-hidden="true">
						<div class="modal-dialog modal-dialog-centered" role="document">
					    <div class="modal-content">
					      <div class="modal-header">
					      	<h5 class="modal-title" id="coverageHistoryTitle">Coverage History</h5>
					      	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					          <span aria-hidden="true">&times;</span>
					        </button>
								</div>
								<div class="modal-body">
									<form class="form my-2 my-lg-0">
                     <input id="searchParameter" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" onkeyup="filter()">
                          <!--<button class="btn btn-outline-success my-2 my-sm-0" type="submit" onclick="filter()">Search</button>-->
                     </form>
									<table class="table table-sm table-bordered">
			              <thead class="thead-dark">
			                <tr>
			                  <th class="align-middle" scope="col">Title</th>
			                  <th class="align-middle" scope="col">Name</th>
			                  <th class="align-middle" scope="col">Duration</th>
			                </tr>
			              </thead>
			              <tbody>
			              <% coverage.forEach(function(data,index){ %>
			              <tr>
			              <th scope="row"><%= data.position %></th>
	                  <td><%= data.name %></td>
	                  <td><%= moment(data.coverageStart).format(shortDateFormat) %> - <%= moment(data.coverageEnd).format(shortDateFormat) %></td>
	                  </tr>
	                  <% }); %>
	                  </tbody>
	                  </table>
								</div>
							</div>
						</div>
					</div>
				</div>
        </div>
        </div>
        <div class = "row">
        <div class="col-lg-12 col-md-12 col-sm-12 border border-dark p-5">
          <h1>Client Contacts</h1>
          <table class="table table-sm table-bordered" id="clientContacts">
              <thead class="thead-dark">
                <tr>
                  <th class="align-middle" scope="col">Title</th>
                  <th class="align-middle" scope="col" hidden>ID</th>
                  <th class="align-middle" scope="col">Name</th>
                  <th class="align-middle" scope="col">email</th>
                  <th class="align-middle" scope="col">Phone</th>
                  <th class="align-middle" scope="col">Location</th>
                  <th class="align-middle" scope="col">Manager</th>
                  <th class="align-middle" scope="col">Fidessa Advocate?</th>
                  <th class="align-middle" scope="col">Comments</th>
                </tr>
              </thead>
              <tbody>
                <% if (client.length === 0) { %>
        					<th scope="row"><input type='text' id='newPositionCC' value=''></th>
        					<td hidden><input type='text' id='newIDCC' value=''></td>
                  <td><input type='text' id='newNameCC' value=''></td>
                  <td><input type='text' id='newEmailCC' value=''></td>
                  <td><input type='text' id='newPhoneCC' value=''></td>
                  <td><input type='text' id='newLocationCC' value=''></td>
                  <td><input type='text' id='newManagerCC' value=''></td>
                  <td><input type='text' id='newFidessaAdvocate' value=''></td>
                  <td><input type='text' id='newCommentsCC' value=''></td>
		              <td class='options'><ul><li><button id="addRowCC" class="add align-middle btn btn-sm btn-outline-success my-2 my-sm-0" type="submit" onclick="addContactRow('CC', '<%= source[0].clientMnemonic %>');">Add Row</button></li></ul></td>
		            <% } %>
                <% client.forEach(function(data, index){ %>
                  <tr id = rowCC>
                    <th scope="row"><input type='text' id='newPositionCC' value='<%= data.position %>'></th>
                    <td hidden><input type='text' id='newIDCC' value='<%= data._id %>'></td>
                    <td><input type='text' id='newNameCC' value='<%= data.name %>'></td>
                    <td><input type='text' id='newEmailCC' value='<%= data.email %>'></td>
	                  <td><input type='text' id='newPhoneCC' value='<%= data.phone %>'></td>
	                  <td><input type='text' id='newLocationCC' value='<%= data.location %>'></td>
	                  <td><input type='text' id='newManagerCC' value='<%= data.managerName %>, <%= data.managerTitle %>'></td>
                    <td><input type='text' id='newFidessaAdvocate' value='<%= data.advocate %>'></td>
                    <td><input type='text' id='newCommentsCC' value='<%= data.comments %>'></td>
          			
          					<script>
          					  fillContactRow('CC')
                      <% if (index !== client.length - 1) { %>
        					    document.getElementById("rowCC").outerHTML="";
        					    <% } %>
          					</script>
          					<td class='options'><ul><li><button id="addRowCC" class="add align-middle btn btn-sm btn-outline-success my-2 my-sm-0" type="submit" onclick="addContactRow('CC', '<%= source[0].clientMnemonic %>');">Add Row</button></li></ul></td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
        </div>
      </div>
      <div>
        <p id="hiddenEntry" hidden></p>
      </div>
      
                        <div class="row">
                                    <div class="col-lg-12 col-md-12 col-sm-12 border border-dark p-5">
                                                <h1>Fidessa Supported Flows</h1>
													<table id = "fidessaUsedSystems" class="table table-sm table-bordered" id="fidessaFlows">
														<thead class="thead-dark">
															<tr>
															  <th class="align-middle" scope="col">Flow Type</th>
															  <th class="align-middle" scope="col" hidden>ID</th>
															  <th class="align-middle" scope="col">System</th>
															  <th class="align-middle" scope="col">Comments</th>
															</tr>
														</thead>
														<tbody>
															<% var clientSupportedFlows = bio[0].flows.filter(item => item.supported === true);
															   //var fidessaFlowType
															   var systems = []
															   clientSupportedFlows.forEach(function(data, index){ %>
															   <tr id = "rowFF">
															   <th scope="row"><input type='text' id='newFlowTypeFF' value='<%= data.flowType %>'></th>
															   <td hidden><input type='text' id='newIDFF' value='<%= data._id %>'></td>
															   <td><input type='text' id='newFlowSystemFF' value='<%= data.system %>'></td>
															   <td><input type='text' id='newFlowCommentsFF' value='<%= data.comment %>'></td>
															   <script>
															    fillFlowsRow('FF', '<%= source[0].clientMnemonic %>')
                    					    document.getElementById("rowFF").outerHTML="";
															  </script>
															  </tr>
															<% }) %>
															  <td>
                                  <select id="flowTypeFF" data-style="btn-info" name="selectpicker" onchange="getSystems('FF', <%= JSON.stringify(flow) %>)">
                                      <optgroup label="Select Flow Type">
                                          <option value="" hidden></option>
                                          <% var fidessaSupportedFlows = flow.filter(item => item.supported === true);
                                          fidessaSupportedFlows.forEach(function(data){ %>
                                          <option value="<%= data.flowType %>"><%= data.flowType %></option>
                                          <% }) %>
                                      </optgroup>
                                  </select>
                                </td>
                                <td>
                                  <select id="flowSystemFF" data-style="btn-info" name="selectpicker">
                                      <optgroup label="Select System">
                                          <option value="" hidden></option>
                                          <script>
                                          function showFidessaFlowSystems(systems) {
                                            var select = document.getElementById("flowSystemFF");
                                            if (select.length > 1) {
                                              do {
                                                select.remove(1)
                                              }
                                              while(select.length > 1)
                                              
                                            }
                                          
                                            for(var i = 0; i < systems.length; i++) {
                                              var opt = systems[i];
                                              var el = document.createElement("option");
                                              el.textContent = systems[i];
                                              el.value = systems[i];
                                              select.options.add(el);
                                            }
                                          }
                                        </script>
                                      </optgroup>
                                  </select>
                                </td>
                                <td><input type='text' id='flowCommentsFF'></td>
                                <td class='options'><ul><li><button id="addRowFF" class="add align-middle btn btn-sm btn-outline-success my-2 my-sm-0" type="submit" onclick="addFlowsRow('FF', '<%= source[0].clientMnemonic %>')">Add Row</button></li></ul></td>
														</tbody>
													</table>
                        </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 border border-dark p-5">
                                                <h1>Adjacent Systems</h1>
												<table id="adjacentFlows" class="table table-sm table-bordered">
														<thead class="thead-dark">
															<tr>
															  <th class="align-middle" scope="col">Flow Type</th>
															  <th class="align-middle" scope="col" hidden>ID</th>
															  <th class="align-middle" scope="col">System</th>
															  <th class="align-middle" scope="col">Comments</th>
															</tr>
														</thead>
														<tbody>
															<% var clientAdjacentSystems =  bio[0].flows.filter(item => item.adjacent === true);
															   clientAdjacentSystems.forEach(function(data){ %>
															   <tr id = rowAD>
															   <th scope="row"><input type='text' id='newFlowTypeAD' value='<%= data.flowType %>'></th>
															   <td hidden><input type='text' id='newIDAD' value='<%= data._id %>'></td>
															   <td><input type='text' id='newFlowSystemAD' value='<%= data.system %>'></td>
															   <td><input type='text' id='newFlowCommentsAD' value='<%= data.comment %>'></td>
															   <script>
															    fillFlowsRow('AD', '<%= source[0].clientMnemonic %>')
                    					    document.getElementById("rowAD").outerHTML="";
															  </script>
															  </tr>
															<% }) %>
															  <td>
                                  <select id="flowTypeAD" data-style="btn-info" name="selectpicker" onchange="getSystems('AD', <%= JSON.stringify(flow) %>)">
                                      <optgroup label="Select Flow Type">
                                          <option value="" hidden></option>
                                          <% var fidessaAdjacentSystems = flow.filter(item => item.supported === false && item.adjacent === true);
                                          fidessaAdjacentSystems.forEach(function(data){ %>
                                          <option value="<%= data.flowType %>"><%= data.flowType %></option>
                                          <% }) %>
                                      </optgroup>
                                  </select>
                                </td>
                                <td>
                                  <select id="flowSystemAD" data-style="btn-info" name="selectpicker">
                                      <optgroup label="Select System">
                                          <option value="" hidden></option>
                                          <script>
                                          function showFidessaAdjacentSystems(systems) {
                                            var select = document.getElementById("flowSystemAD");
                                            if (select.length > 1) {
                                              do {
                                                select.remove(1)
                                              }
                                              while(select.length > 1)
                                              
                                            }
                                          
                                            for(var i = 0; i < systems.length; i++) {
                                              var opt = systems[i];
                                              var el = document.createElement("option");
                                              el.textContent = systems[i];
                                              el.value = systems[i];
                                              select.options.add(el);
                                            }
                                          }
                                        </script>
                                      </optgroup>
                                  </select>
                                </td>
                                <td><input type='text' id='flowCommentsAD'></td>
                                <td class='options'><ul><li><button id="addRowAD" class="add align-middle btn btn-sm btn-outline-success my-2 my-sm-0" type="submit" onclick="addFlowsRow('AD', '<%= source[0].clientMnemonic %>')">Add Row</button></li></ul></td
														</tbody>
													</table>

                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 border border-dark p-5">
                                                <h1>Non-Adjacent Systems</h1>
												<table id="nonAdjacentFlows" class="table table-sm table-bordered">
														<thead class="thead-dark">
															<tr>
															  <th class="align-middle" scope="col">Flow Type</th>
															  <th class="align-middle" scope="col" hidden>ID</th>
															  <th class="align-middle" scope="col">System</th>
															  <th class="align-middle" scope="col">Comments</th>
															</tr>
														</thead>
														<tbody>
															<% var clientNonAdjacentSystems = bio[0].flows.filter(item => item.supported === false && item.adjacent === false);
															   clientNonAdjacentSystems.forEach(function(data){ %>
															   <tr id = rowNA>
															   <th scope="row"><input type='text' id='newFlowTypeNA' value='<%= data.flowType %>'></th>
															   <td hidden><input type='text' id='newIDNA' value='<%= data._id %>'></td>
															   <td><input type='text' id='newFlowSystemNA' value='<%= data.system %>'></td>
															   <td><input type='text' id='newFlowCommentsNA' value='<%= data.comment %>'></td>
															   <script>
															    fillFlowsRow('NA', '<%= source[0].clientMnemonic %>')
                    					    document.getElementById("rowNA").outerHTML="";
															  </script>
															  </tr>
															<% }) %>
															<td>
                                  <select id="flowTypeNA" data-style="btn-info" name="selectpicker" onchange="getSystems('NA', <%= JSON.stringify(flow) %>)">
                                      <optgroup label="Select Flow Type">
                                          <option value="" hidden></option>
                                          <% var fidessaNonAdjacentSystems = flow.filter(item => item.supported === false && item.adjacent === false);
                                          fidessaNonAdjacentSystems.forEach(function(data){ %>
                                          <option value="<%= data.flowType %>"><%= data.flowType %></option>
                                          <% }) %>
                                      </optgroup>
                                  </select>
                                </td>
                                <td>
                                  <select id="flowSystemNA" data-style="btn-info" name="selectpicker">
                                      <optgroup label="Select System">
                                          <option value="" hidden></option>
                                          <script>
                                          function showFidessaNonAdjacentSystems(systems) {
                                            var select = document.getElementById("flowSystemNA");
                                            if (select.length > 1) {
                                              do {
                                                select.remove(1)
                                              }
                                              while(select.length > 1)
                                              
                                            }
                                          
                                            for(var i = 0; i < systems.length; i++) {
                                              var opt = systems[i];
                                              var el = document.createElement("option");
                                              el.textContent = systems[i];
                                              el.value = systems[i];
                                              select.options.add(el);
                                            }
                                          }
                                        </script>
                                      </optgroup>
                                  </select>
                                </td>
                                <td><input type='text' id='flowCommentsNA'></td>
                                <td class='options'><ul><li><button id="addRowNA" class="add align-middle btn btn-sm btn-outline-success my-2 my-sm-0" type="submit" onclick="addFlowsRow('NA', '<%= source[0].clientMnemonic %>')">Add Row</button></li></ul></td
														</tbody>
													</table>

                                    </div>
                        </div>
            </div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
  </body>
</html>
